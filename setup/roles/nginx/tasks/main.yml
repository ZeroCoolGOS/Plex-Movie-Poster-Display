---
# Setup PHP with NGINX

- name: Add index.php to index list
  replace: 
    path: "{{ nginx_config }}"
    regexp: '^(\s+)(index index.html index.htm.*;)'
    replace: '\1index.php \2'
    backup: yes

- name: Uncomment - php location
  replace:
    path: "{{ nginx_config }}"
    regexp: '#(.*location ~ \\.php.*{)'
    replace: '\1'
    backup: yes

- name: Uncomment - fastcgi-php.conf
  replace:
    path: "{{ nginx_config }}"
    regexp: '#(.*include snippets\/fastcgi-php.conf.*;)'
    replace: '\1'
    backup: yes

- name: Uncomment - Fastcgi pass
  replace:
    path: "{{ nginx_config }}"
    regexp: '#(.*fastcgi_pass\s*unix:\/var\/run\/\php\/php.*;)'
    replace: '\1'
    backup: yes

- name: Uncomment - curl
  replace:
    path: "{{ nginx_config }}"
    after: '#.*fastcgi_pass [0-9].*;\n'
    before: '\n.*?#.*deny access to.*'
    regexp: '#(.*})$'
    replace: '\1'
    backup: yes

# Setup PHP information file.

# - name: Update file
#   lineinfile:
#     state: present
#     path: /var/www/html/index.php
#     line: '<?php echo phpinfo(); ?>'
#     insertbefore: BOF
